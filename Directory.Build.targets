<Project>
  
  <Target Name="CheckForBuildTools">
    <Error Condition="!Exists('$(ToolsDir)')"
           Text="The tools directory [$(ToolsDir)] does not exist. Please run build in the root of the repo to ensure the tools are installed before attempting to build an individual project." />
  </Target>

  <Target Name="CopyNativeAssemblies"
          BeforeTargets="PrepareForRun">

    <PropertyGroup>
      <NativeLibPrefix Condition="'$(TargetOS)' == 'linux' OR '$(TargetOS)' == 'mac'">lib</NativeLibPrefix>
      <NativeLibExtension Condition="'$(TargetOS)' == 'windows'">.dll</NativeLibExtension>
      <NativeLibExtension Condition="'$(TargetOS)' == 'linux'">.so</NativeLibExtension>
      <NativeLibExtension Condition="'$(TargetOS)' == 'mac'">.dylib</NativeLibExtension>
    </PropertyGroup>

    <ItemGroup>
      <NativeAssemblyReference>
        <FullAssemblyPath>$(NativeAssetsBuiltPath)$(NativeLibPrefix)%(NativeAssemblyReference.Identity)</FullAssemblyPath>
      </NativeAssemblyReference>
      <NativeAssemblyReferenceCpu>
        <FullAssemblyPath>$(NativeAssetsBuiltPathCpu)$(NativeLibPrefix)%(NativeAssemblyReferenceCpu.Identity)</FullAssemblyPath>
      </NativeAssemblyReferenceCpu>
      <NativeAssemblyReferenceCuda>
        <FullAssemblyPath>$(NativeAssetsBuiltPathCuda)$(NativeLibPrefix)%(NativeAssemblyReferenceCuda.Identity)</FullAssemblyPath>
      </NativeAssemblyReferenceCuda>
    </ItemGroup>

    <Copy SourceFiles = "@(NativeAssemblyReference->'%(FullAssemblyPath)')" DestinationFolder="$(OutputPath)" SkipUnchangedFiles="true">
      <Output TaskParameter="DestinationFiles" ItemName="FileWrites"/>
    </Copy>

    <Copy SourceFiles = "@(NativeAssemblyReferenceCpu->'%(FullAssemblyPath)')" DestinationFolder="$(OutputPath)" SkipUnchangedFiles="true">
      <Output TaskParameter="DestinationFiles" ItemName="FileWrites"/>
    </Copy>

    <Copy SourceFiles = "@(NativeAssemblyReferenceCuda->'%(FullAssemblyPath)')" DestinationFolder="$(OutputPath)" SkipUnchangedFiles="true">
      <Output TaskParameter="DestinationFiles" ItemName="FileWrites"/>
    </Copy>

  </Target>
  
</Project>